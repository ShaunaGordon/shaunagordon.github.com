title: (SilverStripe) Syntax Highlighter Not Working? Try This Workaround!
date: 2011-01-11 17:00
category: tech
tags: tutorials, silverstripe
slug: silverstripe-syntax-highlighter-not

<div class='post'>
<p>So, after three days of failed code and equally failed Google searches, I finally got <a href="http://alexgorbatchev.com/SyntaxHighlighter/" target="_blank">Alex Gorbatchev's SyntaxHighlighter</a> working with SilverStripe.</p><!-- more --><h2>The Problem</h2><p>SyntaxHighlighter comes with something like 30 styles, known as "brushes," for highlighting consistent with different language styles. Since I work with a number of different languages, I wanted to have them available to use, but not load them all on every page. The recent versions have an autoloader feature, which is awesome, and worked great...on my development server. My production server? Not so much. In fact, for some reason, I kept getting the error "Could not find brush for: [insert requested language here]", even though I could link to it just fine.</p><p>I didn't have the patience to figure out what was wrong (the whole "shoemaker's kids go barefoot" thing), but my guess is that it has something to do with something on Apache and rewriting (my dev server is Nginx, which I've grown to love thanks to my latest client, while the production server is Apache with a cPanel front). Instead, I decided to make a workaround.</p><h2>The Solution</h2><p>Perhaps, I'm a carpenter with only a hammer in this situation, so I see this as a nail, even if it really isn't, but I decided to solve the problem The PHP Way&trade;.</p><p>First, of course, download SyntaxHighlighter and unzip it into the root of your SilverStripe install (I just named its root folder "sh" for easy coding). Don't forget to pick up the <a title="SyntaxHL TinyMCE plugin" href="https://github.com/RichGuk/syntaxhl" target="_blank">SyntaxHL TinyMCE plugin</a> for the HTML Editor and install it (in SilverStripe 2.4.4, copy the extracted files into /sapphire/thirdparty/tinymce/plugins/), so you can have a convenient button in which to add your code.</p><p>Now, let's get down to the fun!</p><p>The first thing we need to do is add a field into the CMS so we can list what brushes we want to use when we use SyntaxHighlighter on a page, so in the model for the page type you're adding brushes to, put the following:</p><pre class="brush: php;fontsize: 100; first-line: 1; highlight: [3]; ">function getCMSfields(){<br />    $fields = parent::getCMSfields();<br />    $fields-&gt;addFieldToTab('Root.Content.Main', new TextField('Brushes'));<br /><br />    return $fields;<br />}</pre><p>If you already have the getCMSfields() function in your model, simply add the highlighted line.</p><p>Since this was more or less a quick-and-dirty solution, and I'm the only one using my CMS, all I did was add a basic text field to the bottom of my main content page, where I'd add a comma-separated list of the brushes I want to use. If you need to ensure consistency, or want to control what brushes are available to the user, you could make the text field another type of field, such as a set of checkboxes.</p><p>In the controller for the page type you want to add your brushes to, create a function to provide the array that view will use:</p><pre class="brush: php;fontsize: 100; first-line: 1; ">function Brushes() {<br />        $BrushSet = new DataObjectSet();<br />        $shBrushes = explode(',', $this-&gt;Brushes);<br /><br />        foreach ($shBrushes as $brush) {<br />            $BrushSet-&gt;push(new ArrayData(array(<br />                        'Brush' =&gt; ucwords($brush)<br />                    )));<br />        }<br /><br />        return $BrushSet;<br />    }</pre><p>The controller function simply takes the comma-separated string, creates an array, then puts it into the DataObjectSet for outputting into the view. The ucwords() call ensures that each item is capitalized, following the files' naming structure.</p><p>Now, on to the view!</p><p>First, we need to add the base files to make SyntaxHighlighter work. I've added the Django theme, since it matches my site's color scheme as of this writing (and I just like it). SyntaxHighlighter comes with a number of themes, so just load what you want after the shCore.css file for the color scheme. After that, add the core JavaScript file. I use the regular syntax for the JavaScript files so that I can add them where I want (the template syntax, by default, automatically puts them at the bottom of the document, either above the closing body tag, or above any existing script tags; I've found that this will keep some scripts from working), and put the core file in the document head. Below that is the custom control for the script tag that will load the individual brushes. Finally, the shLoad file, which applies the brushes to the tags that call for them.</p><pre class="brush: xml;fontsize: 100; first-line: 1; "><pre class="brush: xml;fontsize: 100; first-line: 1; ">&lt;% require css(sh/styles/shCore.css) %&gt;<br />&lt;% require css(sh/styles/shThemeDjango.css) %&gt;<br />&lt;script type="text/javascript" src="/sh/scripts/shCore.js"&gt;&lt;/script&gt;<br /><br />&lt;% control Brushes %&gt;<br />    &lt;% include Brush %&gt;<br />&lt;% end_control %&gt;<br /><br />&lt;script type="text/javascript" src="/sh/shLoad.js"&gt;&lt;/script&gt;</pre></pre><p>Finally, we need to create the include file for our Brush control. This is simply the following script call:</p><pre class="brush: xml;fontsize: 100; first-line: 1; ">&lt;script type="text/javascript" src="/sh/scripts/shBrush{$Brush}.js"&gt;&lt;/script&gt;</pre><p>Note the {$Brush} variable in the tag. Conveniently, the brushes are named according to a standard, with the last segment being the language the brush is for. The only caveat this means for our setup is that we have to remember the names the files use. This could be remedied by using a system that generates the options, though doing that would require going into the code again if you add new brushes (either adding to the files or adding more choices to your list). Such is the trade-off to be considered, based on your circumstances.</p><p>Don't forget to add the button to your editor, in your mysite/_config.php file, add the lines:</p><pre class="brush: php;fontsize: 100; first-line: 1; ">// SyntaxHighlighter TinyMCE Plugin<br />HtmlEditorConfig::get('cms')-&gt;enablePlugins('syntaxhl');<br />HtmlEditorConfig::get('cms')-&gt;insertButtonsAfter('charmap', 'syntaxhl');</pre><p>I added the button after the Specials Character map, since it's at the end of the formatting row, but it can really be added anywhere. You just need to know the name of the button you want to put it after.</p><h2>Conclusion</h2><p>And there you have it. A quick /dev/build and you should be up and running with syntax highlighting, The PHP Way&trade;!</p><p>The AuthoLoader is probably a better way of doing it, if you can (because it calls the brushes automatically when you request them), but this should provide a nice workaround if you find yourself in my situation and can't seem to get the AutoLoader working properly.</p></div>
